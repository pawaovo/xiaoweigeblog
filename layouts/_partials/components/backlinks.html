{{ $type := .type }}
{{ $filename := .filename }}
{{ $ctx := .context }}
{{ $referencedBy := slice }}

{{ $paramMap := dict "library" "mentioned_books" "cards" "related_cards" "posts" "related_posts" }}
{{ $paramName := index $paramMap $type }}

{{ if $paramName }}
    {{ range $ctx.Site.Pages }}
        {{ if and (isset .Params $paramName) (in (index .Params $paramName) $filename) }}
            {{ $referencedBy = $referencedBy | append . }}
        {{ end }}
    {{ end }}
{{ end }}

{{- /* 如果有文章引用这个页面，就显示它们 */ -}}
{{ if gt (len $referencedBy) 0 }}
<section class="related-posts post-content my-5">
    <h2 class="text-base m-0 flex items-center gap-2">
        <span>反向链接</span>
        <span class="inline-block bg-neutral-200 dark:bg-neutral-700 rounded-full px-1 text-secondary cursor-help text-sm"
            data-tooltip="这里列出了引用了该页面的其他文章">?</span>
    </h2>
    <ul class="my-4 list-none ps-4">
        {{- range $referencedBy }}
        <li class="flex gap-4">
            <span class="text-secondary">→</span>
            <a href="{{ .Permalink }}" data-tooltip="查看文章：{{ .Title }}">{{ .Title }}</a>
        </li>
        {{- end }}
    </ul>
</section>
{{ end }}
